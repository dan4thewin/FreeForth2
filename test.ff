variable plan
variable okcnt
variable skipcnt
variable index
variable verbose

: green.	dim green foreground ;
: red.		red foreground ;
: cyan.		cyan foreground ;
: yellow.	yellow foreground ;
: n.		normal ;

: >plan		dup plan! cyan. ."1.." .dec n. cr ;
: `tally	plan@ okcnt@ skipcnt@ + - 0= drop IF cyan. ."PASSED" 0
		ELSE red. ."FAILED" 1 THEN n. cr ;
: tally		`tally drop ;
: tally-exit	`tally exit ;

variable savedepth
: `newtest	index@ ++ 0 savedepth! depth 0; !"stack must be empty" ;
: t{`		;` verbose@ IF. 2 >in -! lnparse tuck type space >in -! THEN `newtest ;
: ->`		;` depth savedepth! ;
: `dd		depth TIMES drop REPEAT ;
: `chkdepth	depth savedepth@ 2* - 0; yellow. ."wrong number of results^J" n. ;
: `chkvals	savedepth@ >>rr BEGIN depth 0; dropr> <> 2drop IF depth +r BREAK REPEAT
		yellow. ."incorrect result^J" n. ;
: `chk		`chkdepth `chkvals 0= ? ;
: `ok?		`chk 0= IF okcnt@ ++ green. ."ok " ELSE red. ."not ok " `dd THEN
		index@ .dec n. cr ;
: }t`		;` `ok? ;
: skip`		skipcnt@ ++ \` ;

: testing` ;` 8 >in -! lnparse cyan. type n. cr ;
